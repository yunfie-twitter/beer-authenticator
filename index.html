<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beer Authenticator - TOTPË™çË®ºÂô®</title>
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.13.1/dist/cdn/beer.min.css" rel="stylesheet" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.13.1/dist/cdn/beer.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.2/dist/cdn/material-dynamic-colors.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/otpauth@9.2.2/dist/otpauth.umd.js"></script>
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #FF9800;
            --success-color: #4CAF50;
            --error-color: #F44336;
            --surface-color: #ffffff;
            --surface-variant-color: #f5f5f5;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --surface-color: #121212;
                --surface-variant-color: #1e1e1e;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, var(--surface-color) 0%, var(--surface-variant-color) 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            opacity: 0.7;
            font-size: 1.1em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--surface-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="file"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 1em;
            background: var(--surface-variant-color);
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="file"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #1976D2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        .btn-secondary {
            background: var(--surface-variant-color);
            color: inherit;
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-danger {
            background: #FF5252;
            color: white;
            font-size: 0.9em;
            padding: 8px 16px;
            width: auto;
        }

        .btn-danger:hover {
            background: #FF1744;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.6);
            transition: all 0.3s ease;
            width: auto;
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        #qr-canvas {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .account-card {
            background: var(--surface-variant-color);
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .account-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
        }

        .account-name {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 8px;
            word-break: break-all;
        }

        .account-issuer {
            font-size: 0.85em;
            opacity: 0.6;
            margin-bottom: 15px;
        }

        .totp-code {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background: var(--surface-color);
            border-radius: 8px;
            margin-bottom: 15px;
            letter-spacing: 4px;
            user-select: all;
            color: var(--primary-color);
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--secondary-color));
            width: 100%;
            transition: width 0.1s linear;
        }

        .account-actions {
            display: flex;
            gap: 10px;
        }

        .account-actions button {
            flex: 1;
            font-size: 0.85em;
            padding: 8px 12px;
            width: auto;
        }

        .btn-copy {
            background: var(--primary-color);
            color: white;
        }

        .btn-copy:hover {
            background: #1565C0;
        }

        .info-message {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid var(--success-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95em;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid var(--error-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95em;
            color: var(--error-color);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.6;
        }

        .empty-state svg {
            width: 60px;
            height: 60px;
            margin-bottom: 20px;
            opacity: 0.4;
        }

        .divider {
            height: 2px;
            background: rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.6;
            font-size: 0.9em;
        }

        @media (prefers-color-scheme: dark) {
            input[type="text"],
            input[type="file"],
            textarea {
                color: #ffffff;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê Beer Authenticator</h1>
            <p>Modern TOTPË™çË®ºÂô® - QR„Ç≥„Éº„Éâ„Å®ÊâãÂÖ•Âäõ„Å´ÂØæÂøú</p>
        </header>

        <div class="main-grid">
            <!-- Add Account Card -->
            <div class="card">
                <h2>„Ç¢„Ç´„Ç¶„É≥„Éà„ÇíËøΩÂä†</h2>
                
                <div class="tabs">
                    <button class="tab-btn active" data-tab="qr">QR„Ç≥„Éº„Éâ</button>
                    <button class="tab-btn" data-tab="manual">ÊâãÂÖ•Âäõ</button>
                </div>

                <!-- QR Code Tab -->
                <div class="tab-content active" id="qr-tab">
                    <div class="form-group">
                        <label>QR„Ç≥„Éº„ÉâÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</label>
                        <input type="file" id="qr-file" accept="image/*">
                    </div>
                    <p style="font-size: 0.9em; opacity: 0.7; margin-bottom: 15px;">
                        „Åæ„Åü„ÅØ„ÄÅ„Ç´„É°„É©„ÅßË™≠„ÅøËæº„ÇÄÔºö
                    </p>
                    <div class="form-group">
                        <input type="file" id="qr-camera" accept="video/*" capture="environment">
                    </div>
                    <button class="btn-primary" onclick="readQRCode()">QR„Ç≥„Éº„Éâ„ÇíË™≠„ÅøËæº„ÇÄ</button>
                    <canvas id="qr-canvas" style="display: none;"></canvas>
                    <div id="qr-result"></div>
                </div>

                <!-- Manual Input Tab -->
                <div class="tab-content" id="manual-tab">
                    <div class="form-group">
                        <label>„Ç¢„Ç´„Ç¶„É≥„ÉàÂêç</label>
                        <input type="text" id="account-name" placeholder="‰æã: GitHub">
                    </div>
                    <div class="form-group">
                        <label>Áô∫Ë°åËÄÖÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ</label>
                        <input type="text" id="issuer-name" placeholder="‰æã: github.com">
                    </div>
                    <div class="form-group">
                        <label>„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà„Ç≠„Éº</label>
                        <input type="text" id="secret-key" placeholder="Base32„Ç®„É≥„Ç≥„Éº„Éâ„Åï„Çå„Åü„Ç≠„Éº">
                    </div>
                    <button class="btn-primary" onclick="addAccountManual()">„Ç¢„Ç´„Ç¶„É≥„Éà„ÇíËøΩÂä†</button>
                </div>
            </div>

            <!-- Accounts List Card -->
            <div class="card">
                <h2>ÁôªÈå≤Ê∏à„Åø„Ç¢„Ç´„Ç¶„É≥„Éà</h2>
                <p style="font-size: 0.9em; opacity: 0.7; margin-bottom: 20px;">
                    <strong id="account-count">0</strong>ÂÄã„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô
                </p>
                
                <div id="accounts-container" class="accounts-grid">
                    <div class="empty-state">
                        <p>„Ç¢„Ç´„Ç¶„É≥„Éà„Åå„Åæ„Å†ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                        <p style="font-size: 0.85em;">Â∑¶„ÅÆ„Éë„Éç„É´„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>üç∫ Built with Beer CSS + Material Dynamic Colors</p>
            <p><a href="https://github.com/yunfie-twitter/beer-authenticator" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script>
        // Initialize
        const STORAGE_KEY = 'beer-authenticator-accounts';
        let accounts = [];

        // Load accounts from localStorage
        function loadAccounts() {
            const stored = localStorage.getItem(STORAGE_KEY);
            accounts = stored ? JSON.parse(stored) : [];
            renderAccounts();
        }

        // Save accounts to localStorage
        function saveAccounts() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts));
            renderAccounts();
        }

        // Add account from manual input
        function addAccountManual() {
            const name = document.getElementById('account-name').value.trim();
            const issuer = document.getElementById('issuer-name').value.trim();
            const secret = document.getElementById('secret-key').value.trim().toUpperCase().replace(/\s/g, '');

            if (!name || !secret) {
                alert('„Ç¢„Ç´„Ç¶„É≥„ÉàÂêç„Å®„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà„Ç≠„Éº„ÅØÂøÖÈ†à„Åß„Åô');
                return;
            }

            if (!/^[A-Z2-7=]+$/.test(secret)) {
                alert('„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà„Ç≠„Éº„ÅØBase32ÂΩ¢Âºè„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');
                return;
            }

            const account = {
                id: Date.now(),
                name,
                issuer: issuer || name,
                secret,
                createdAt: new Date().toISOString()
            };

            accounts.push(account);
            saveAccounts();

            // Clear inputs
            document.getElementById('account-name').value = '';
            document.getElementById('issuer-name').value = '';
            document.getElementById('secret-key').value = '';

            alert('„Ç¢„Ç´„Ç¶„É≥„Éà„ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ');
        }

        // Read QR Code
        function readQRCode() {
            const fileInput = document.getElementById('qr-file');
            const cameraInput = document.getElementById('qr-camera');
            const file = fileInput.files[0] || cameraInput.files[0];

            if (!file) {
                alert('„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.getElementById('qr-canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height);

                    if (code) {
                        parseOTPAuth(code.data);
                    } else {
                        alert('QR„Ç≥„Éº„Éâ„ÅåË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì');
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Parse otpauth:// URI
        function parseOTPAuth(uri) {
            try {
                const auth = OTPAuth.URI.parse(uri);
                const account = {
                    id: Date.now(),
                    name: auth.label || 'Unknown',
                    issuer: auth.issuer || 'Unknown',
                    secret: auth.secret.base32,
                    createdAt: new Date().toISOString()
                };

                accounts.push(account);
                saveAccounts();
                alert('„Ç¢„Ç´„Ç¶„É≥„Éà„ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ');

                // Clear file inputs
                document.getElementById('qr-file').value = '';
                document.getElementById('qr-camera').value = '';
            } catch (error) {
                alert('QR„Ç≥„Éº„Éâ„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }

        // Generate TOTP code
        function generateTOTP(secret) {
            try {
                const auth = new OTPAuth.TOTP({
                    secret: OTPAuth.Secret.fromBase32(secret),
                });
                return auth.generate();
            } catch (error) {
                console.error('TOTPÁîüÊàê„Ç®„É©„Éº:', error);
                return '„Ç®„É©„Éº';
            }
        }

        // Get remaining time
        function getRemainingTime() {
            return 30 - (Math.floor(Date.now() / 1000) % 30);
        }

        // Render accounts
        function renderAccounts() {
            const container = document.getElementById('accounts-container');
            document.getElementById('account-count').textContent = accounts.length;

            if (accounts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <p>„Ç¢„Ç´„Ç¶„É≥„Éà„Åå„Åæ„Å†ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                        <p style="font-size: 0.85em;">Â∑¶„ÅÆ„Éë„Éç„É´„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = accounts.map(account => `
                <div class="account-card">
                    <div class="account-name">${escapeHtml(account.name)}</div>
                    <div class="account-issuer">${escapeHtml(account.issuer)}</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(getRemainingTime() / 30) * 100}%"></div>
                    </div>
                    <div class="totp-code" id="code-${account.id}">${generateTOTP(account.secret)}</div>
                    <div class="account-actions">
                        <button class="btn-copy" onclick="copyToClipboard('${account.id}')">„Ç≥„Éî„Éº</button>
                        <button class="btn-danger" onclick="deleteAccount(${account.id})">ÂâäÈô§</button>
                    </div>
                </div>
            `).join('');
        }

        // Copy to clipboard
        function copyToClipboard(accountId) {
            const codeElement = document.getElementById(`code-${accountId}`);
            const code = codeElement.textContent;
            navigator.clipboard.writeText(code).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }

        // Delete account
        function deleteAccount(id) {
            if (confirm('„Åì„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                accounts = accounts.filter(a => a.id !== id);
                saveAccounts();
            }
        }

        // Escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const tabName = e.target.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                e.target.classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });

        // Update TOTP codes every second
        setInterval(() => {
            accounts.forEach(account => {
                const codeElement = document.getElementById(`code-${account.id}`);
                if (codeElement) {
                    codeElement.textContent = generateTOTP(account.secret);
                }
            });

            // Update progress bars
            const percentage = (getRemainingTime() / 30) * 100;
            document.querySelectorAll('.progress-fill').forEach(bar => {
                bar.style.width = percentage + '%';
            });
        }, 100);

        // Initial load
        loadAccounts();
    </script>
</body>
</html>